language: java

# Default script is 'mvn test'; We don't have any tests, as we require RSA. Echo something useful, instead
before_install:
  - sudo apt-get update
  - sudo apt-get -y install rpm

script:
#- echo Built releng/com.zeligsoft.dds4ccm.update.atcd/target/dds4ccm_*.v*.zip
- echo Built releng/com.zeligsoft.dds4ccm.update.axcioma/target/dds4ccm_*.v*.zip
- rpmbuild -ba --clean -vv --define "_projectdir $TRAVIS_BUILD_DIR/releng/com.zeligsoft.dds4ccm.update.axcioma" --define "_git_commit_id $TRAVIS_COMMIT" --define "_git_tag $TRAVIS_TAG" releng/com.zeligsoft.dds4ccm.update.axcioma/rpm_build/zeligsoftCX_axcioma.spec
#- rpmbuild -ba --clean -vv --define "_projectdir $TRAVIS_BUILD_DIR/releng/com.zeligsoft.dds4ccm.update.atcd" --define "_git_commit_id $TRAVIS_COMMIT" --define "_git_tag $TRAVIS_TAG" releng/com.zeligsoft.dds4ccm.update.atcd/rpm_build/zeligsoftCX_atcd.spec

before_deploy:
 #   - "mkdir releng/com.zeligsoft.dds4ccm.update.atcd/target/archive"
 #   - "cp releng/com.zeligsoft.dds4ccm.update.atcd/target/dds4ccm_*.v*.zip releng/com.zeligsoft.dds4ccm.update.atcd/target/archive"
    - "mkdir releng/com.zeligsoft.dds4ccm.update.axcioma/target/archive"
    - "cp releng/com.zeligsoft.dds4ccm.update.axcioma/target/dds4ccm_*.v*.zip releng/com.zeligsoft.dds4ccm.update.axcioma/target/archive"

# Deploy the built zip back to git hub, on releases only
deploy:
  provider: releases
  api_key:
    secure: "AXILeMM3OD0IWqGTY5xjlbtZ+nReEn4oCpsnVUH5P7P9ZjkKla4kl2JXNXkpadMkO3OfwiKQr2amd98dpGoe9Qt21XF39xIRzs4az18GHeXPPuMGGgUJtnWL8Ohh3ZLGlkeK3vq3XgrEN6sCuKcB0+1spkTAbr5M0+kYhnc6Ax6r1Oglw8YHxgooKSrkmP4jOC0SCaKAuRHIWM5oBo/xtD13J2ypmsYcP3tFKIArNre5n1hMNj6fTn+IOMM+rVq7nbFXoBjBM52d54EHju2JswdNLY/VjUbtn4ogow1jF5H/S9THuWLiHWmKzy5A5wWrbpuhInfnM0KAxTZ1C6T/27+Ma1deY2wHCER8lqh9pLE1jbvvHZLLOVeNVaqm51SGq/LYSE7glJO3ZzTWG2YH5dJFzyzzQYzusBUNM41NGiAKxLuxeKnLIJBPeraAnPQWxWK9fOn717HLEtwdJOhHAGy82hX2qVL5jG9xjHvgiLbpYbIoCE/ZxiaUG+oZy5k/cP0WCikfKpBDd+J6HYyFIMg+GKY37ENtf9RLkT7Hf9PvCj4PNXZInq89JYcTz3VczSdJ2dDY7Y6tmSWnEdkibXLe1gY6PdMoig3OgzYBbIpEAzJy8ljHIlLs+d1itbEtyvnfRjL0NMK3Vo6TQXAmTRsB5AQMN7FptwJn37AetpI="
  file_glob: true
  file: 
 #   - releng/com.zeligsoft.dds4ccm.update.atcd/target/archive/*
    - releng/com.zeligsoft.dds4ccm.update.axcioma/target/archive/*
 #   - releng/com.zeligsoft.dds4ccm.update.atcd/rpm_build/noarch/*.rpm
    - releng/com.zeligsoft.dds4ccm.update.axcioma/rpm_build/noarch/*.rpm
  on:
    repo: ZeligsoftDev/CX4CBDDS
    tags: true
  skip_cleanup: true
  draft: true
